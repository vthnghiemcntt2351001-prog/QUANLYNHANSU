@{
    ViewData["Title"] = "Qu·∫£n l√Ω l∆∞∆°ng nh√¢n vi√™n";
    Layout = "~/Views/Shared/_Layout.cshtml"; 
}
<style>
    :root {
        --main-blue: #1d72b8;
        --dark-blue: #155d8b;
        --light-bg: #f8f9fa;
    }
    body {
        background-color: var(--light-bg);
        font-family: "Segoe UI", sans-serif;
    }
    .topbar {
        background: linear-gradient(90deg, var(--main-blue), var(--dark-blue));
        color: white;
        padding: 14px 24px;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .topbar a {
        color: white;
        text-decoration: none;
        font-weight: 500;
    }
    .table th {
        background-color: var(--main-blue);
        color: white;
        text-align: center;
    }
    .salary-cell {
        font-weight: bold;
        color: #198754;
    }
    .card {
        border-radius: 12px;
        border: none;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        background: white;
    }
    .btn-primary {
        background-color: var(--main-blue);
        border: none;
    }
    .btn-primary:hover {
        background-color: var(--dark-blue);
    }
</style>

<div class="container mt-5">
    <div class="card p-4">
        <h3 class="text-center mb-4 text-primary">B·∫¢NG T√çNH L∆Ø∆†NG NH√ÇN VI√äN</h3>

        <div class="d-flex justify-content-end mb-3">
            <button class="btn btn-success" id="btnTinhLuong">üí∞ T√≠nh l∆∞∆°ng</button>
            <button class="btn btn-primary ms-2" id="btnXuatLuong">üì§ Xu·∫•t b·∫£ng l∆∞∆°ng</button>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle text-center" id="tableLuong">
                <thead>
                    <tr>
                        <th>M√£ NV</th>
                        <th>H·ªç t√™n</th>
                        <th>Ch·ª©c v·ª•</th>
                        <th>Ng√†y l√†m vi·ªác</th>
                        <th>L∆∞∆°ng/ng√†y (VNƒê)</th>
                        <th>T·ªïng l∆∞∆°ng (VNƒê)</th>
                    </tr>
                </thead>
                <tbody id="bangChamCong">
                    <tr><td>NV01</td><td>Nguy·ªÖn VƒÉn An</td><td>Nh√¢n vi√™n IT</td><td><input type="number" class="form-control text-center ngay-lam" value="26"></td><td class="luong-ngay">500000</td><td class="tong-luong salary-cell">0</td></tr>
                    <tr><td>NV02</td><td>Tr·∫ßn Th·ªã B√≠ch</td><td>K·∫ø to√°n</td><td><input type="number" class="form-control text-center ngay-lam" value="24"></td><td class="luong-ngay">450000</td><td class="tong-luong salary-cell">0</td></tr>
                    <tr><td>NV03</td><td>L√™ Minh Ch√¢u</td><td>Nh√¢n s·ª±</td><td><input type="number" class="form-control text-center ngay-lam" value="28"></td><td class="luong-ngay">480000</td><td class="tong-luong salary-cell">0</td></tr>
                    <tr><td>NV04</td><td>Ph·∫°m VƒÉn D≈©ng</td><td>Tr∆∞·ªüng ph√≤ng IT</td><td><input type="number" class="form-control text-center ngay-lam" value="25"></td><td class="luong-ngay">700000</td><td class="tong-luong salary-cell">0</td></tr>
                    <tr><td>NV05</td><td>Nguy·ªÖn Th·ªã H·ªìng</td><td>Th∆∞ k√Ω</td><td><input type="number" class="form-control text-center ngay-lam" value="27"></td><td class="luong-ngay">420000</td><td class="tong-luong salary-cell">0</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ‚úÖ Th√™m th∆∞ vi·ªán xu·∫•t Excel -->
<script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>


<script>
    let luongDaTinh = false; // C·ªù ki·ªÉm tra

// N√∫t t√≠nh l∆∞∆°ng
document.getElementById("btnTinhLuong").addEventListener("click", function () {
    const rows = document.querySelectorAll("#bangChamCong tr");
    rows.forEach(row => {
        const ngayLam = parseInt(row.querySelector(".ngay-lam").value) || 0;
        const luongNgay = parseInt(row.querySelector(".luong-ngay").textContent) || 0;
        const tongLuong = ngayLam * luongNgay;
        row.querySelector(".tong-luong").textContent = tongLuong.toLocaleString("vi-VN");
    });

    luongDaTinh = true; // ‚úÖ ƒê√£ t√≠nh xong
    alert("‚úÖ ƒê√£ t√≠nh xong l∆∞∆°ng cho nh√¢n vi√™n!");
});

// N√∫t xu·∫•t Excel
document.getElementById("btnXuatLuong").addEventListener("click", async function () {
    if (!luongDaTinh) { // ‚ùå N·∫øu ch∆∞a t√≠nh
        alert("‚ö†Ô∏è Vui l√≤ng t√≠nh l∆∞∆°ng tr∆∞·ªõc khi xu·∫•t b·∫£ng!");
        return;
    }

    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet("B·∫£ng L∆∞∆°ng NTV");

    // Ti√™u ƒë·ªÅ
    const headers = ["M√£ NV", "H·ªç t√™n", "Ch·ª©c v·ª•", "Ng√†y l√†m vi·ªác", "L∆∞∆°ng/ng√†y (VNƒê)", "T·ªïng l∆∞∆°ng (VNƒê)"];
    worksheet.addRow(headers);

    // D·ªØ li·ªáu
    document.querySelectorAll("#bangChamCong tr").forEach(row => {
        const cells = Array.from(row.querySelectorAll("td")).map(td => {
            const input = td.querySelector("input");
            return input ? input.value : td.textContent.trim();
        });
        worksheet.addRow(cells);
    });

    // Style header
    const headerRow = worksheet.getRow(1);
    headerRow.eachCell(cell => {
        cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: '1D72B8' } };
        cell.font = { color: { argb: 'FFFFFF' }, bold: true };
        cell.alignment = { vertical: 'middle', horizontal: 'center' };
        cell.border = {
            top: { style: 'thin', color: { argb: '000000' } },
            left: { style: 'thin', color: { argb: '000000' } },
            bottom: { style: 'thin', color: { argb: '000000' } },
            right: { style: 'thin', color: { argb: '000000' } }
        };
    });

    // Style d·ªØ li·ªáu + m√†u xen k·∫Ω
    worksheet.eachRow((row, rowNumber) => {
        if (rowNumber > 1) {
            const isEven = rowNumber % 2 === 0;
            const bgColor = isEven ? 'F2F2F2' : 'FFFFFF';
            row.eachCell(cell => {
                cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: bgColor } };
                cell.alignment = { vertical: 'middle', horizontal: 'center' };
                cell.border = {
                    top: { style: 'thin', color: { argb: '000000' } },
                    left: { style: 'thin', color: { argb: '000000' } },
                    bottom: { style: 'thin', color: { argb: '000000' } },
                    right: { style: 'thin', color: { argb: '000000' } }
                };
            });
        }
    });

    // Auto width
    worksheet.columns.forEach(column => {
        let maxLength = 0;
        column.eachCell({ includeEmpty: true }, cell => {
            const text = cell.value ? cell.value.toString() : "";
            maxLength = Math.max(maxLength, text.length);
        });
        column.width = maxLength + 3;
    });

    // Xu·∫•t file
    const buffer = await workbook.xlsx.writeBuffer();
    saveAs(new Blob([buffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" }), "Bang_Luong_NTV.xlsx");
    alert("üì§ Xu·∫•t b·∫£ng l∆∞∆°ng th√†nh c√¥ng!");
});

    
    
</script>
