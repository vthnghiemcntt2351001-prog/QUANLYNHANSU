@{
    ViewData["Title"] = "Qu·∫£n l√Ω ch·∫•m c√¥ng nh√¢n vi√™n";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



    <style>
        :root {
            --main-blue: #1d72b8;
            --dark-blue: #155d8b;
            --light-bg: #f8f9fa;
        }
        body {
            background-color: var(--light-bg);
            font-family: "Segoe UI", sans-serif;
        }
        .topbar {
            background: linear-gradient(90deg, var(--main-blue), var(--dark-blue));
            color: white;
            padding: 14px 24px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .topbar a {
            color: white;
            text-decoration: none;
            font-weight: 500;
        }
        .table th {
            background-color: var(--main-blue);
            color: white;
            text-align: center;
        }
        .card {
            border-radius: 12px;
            border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            background: white;
        }
        .btn-primary {
            background-color: var(--main-blue);
            border: none;
        }
        .btn-primary:hover {
            background-color: var(--dark-blue);
        }
        .salary-cell {
            font-weight: 600;
            color: #1379c7;
        }
    </style>


<div class="topbar">
    <div>üïí Qu·∫£n l√Ω ch·∫•m c√¥ng nh√¢n vi√™n - H·ªá th·ªëng NTV</div>
    <a asp-controller="Home" asp-action="Index">‚Üê Quay l·∫°i Dashboard</a>
</div>

<div class="container mt-5">
    <div class="card p-4">
        <h3 class="text-center mb-4 text-primary">B·∫¢NG CH·∫§M C√îNG NH√ÇN VI√äN</h3>

        <div class="d-flex justify-content-end mb-3">
            <button class="btn btn-success" id="btnTinhCong">üßÆ T√≠nh c√¥ng</button>
            <button class="btn btn-primary ms-2" id="btnXuatChamCong">üì§ Xu·∫•t b·∫£ng ch·∫•m c√¥ng</button>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle text-center" id="tableChamCong">
                <thead>
                    <tr>
                        <th>M√£ NV</th>
                        <th>H·ªç t√™n</th>
                        <th>Ch·ª©c v·ª•</th>
                        <th>Ng√†y l√†m vi·ªác</th>
                        <th>Ng√†y ngh·ªâ</th>
                        <th>T·ªïng c√¥ng</th>
                    </tr>
                </thead>
                <tbody id="bangChamCong">
                    <tr>
                        <td>NV01</td><td>Nguy·ªÖn VƒÉn An</td><td>Nh√¢n vi√™n IT</td>
                        <td><input type="number" class="form-control text-center ngay-lam" value="26" min="0" max="31"></td>
                        <td><input type="number" class="form-control text-center ngay-nghi" value="4" min="0" max="31"></td>
<td class="tong-cong salary-cell">0</td>
                    </tr>
                    <tr>
                        <td>NV02</td><td>Tr·∫ßn Th·ªã B√≠ch</td><td>K·∫ø to√°n</td>
                        <td><input type="number" class="form-control text-center ngay-lam" value="24"></td>
                        <td><input type="number" class="form-control text-center ngay-nghi" value="6"></td>
                        <td class="tong-cong salary-cell">0</td>
                    </tr>
                    <tr>
                        <td>NV03</td><td>L√™ Minh Ch√¢u</td><td>Nh√¢n s·ª±</td>
                        <td><input type="number" class="form-control text-center ngay-lam" value="27"></td>
                        <td><input type="number" class="form-control text-center ngay-nghi" value="3"></td>
                        <td class="tong-cong salary-cell">0</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>


    <!-- Th∆∞ vi·ªán xu·∫•t Excel -->
    <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

    <script>
        let chamCongDaTinh = false;

        // ‚úÖ T√≠nh c√¥ng
        document.getElementById("btnTinhCong").addEventListener("click", function () {
            const rows = document.querySelectorAll("#bangChamCong tr");
            rows.forEach(row => {
                const ngayLam = parseInt(row.querySelector(".ngay-lam").value) || 0;
                const ngayNghi = parseInt(row.querySelector(".ngay-nghi").value) || 0;
                const tongCong = ngayLam - ngayNghi;
                row.querySelector(".tong-cong").textContent = tongCong;
            });

            chamCongDaTinh = true;
            alert("‚úÖ ƒê√£ t√≠nh xong t·ªïng c√¥ng cho nh√¢n vi√™n!");
        });

        // ‚úÖ Xu·∫•t b·∫£ng ch·∫•m c√¥ng ra Excel
        document.getElementById("btnXuatChamCong").addEventListener("click", async function () {
            if (!chamCongDaTinh) {
                alert("‚ö†Ô∏è Vui l√≤ng t√≠nh c√¥ng tr∆∞·ªõc khi xu·∫•t b·∫£ng!");
                return;
            }

            const workbook = new ExcelJS.Workbook();
            const worksheet = workbook.addWorksheet("B·∫£ng Ch·∫•m C√¥ng");

            // Header
            const headers = ["M√£ NV", "H·ªç t√™n", "Ch·ª©c v·ª•", "Ng√†y l√†m vi·ªác", "Ng√†y ngh·ªâ", "T·ªïng c√¥ng"];
            worksheet.addRow(headers);

            // D·ªØ li·ªáu t·ª´ b·∫£ng
            document.querySelectorAll("#bangChamCong tr").forEach(row => {
                const cells = Array.from(row.querySelectorAll("td")).map(td => {
                    const input = td.querySelector("input");
                    return input ? input.value : td.textContent.trim();
                });
                worksheet.addRow(cells);
            });

            // Style header
            const headerRow = worksheet.getRow(1);
headerRow.eachCell(cell => {
                cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: '1D72B8' } };
                cell.font = { color: { argb: 'FFFFFF' }, bold: true };
                cell.alignment = { vertical: 'middle', horizontal: 'center' };
            });

            // Vi·ªÅn + m√†u xen k·∫Ω
            worksheet.eachRow((row, i) => {
                row.eachCell(cell => {
                    cell.border = {
                        top: { style: 'thin', color: { argb: '000000' } },
                        left: { style: 'thin', color: { argb: '000000' } },
                        bottom: { style: 'thin', color: { argb: '000000' } },
                        right: { style: 'thin', color: { argb: '000000' } }
                    };
                    cell.alignment = { vertical: 'middle', horizontal: 'center' };
                    if (i > 1) {
                        cell.fill = {
                            type: 'pattern',
                            pattern: 'solid',
                            fgColor: { argb: i % 2 === 0 ? 'F2F2F2' : 'FFFFFF' }
                        };
                    }
                });
            });

            // Auto width
            worksheet.columns.forEach(col => {
                let max = 0;
                col.eachCell({ includeEmpty: true }, cell => {
                    const text = cell.value ? cell.value.toString() : "";
                    max = Math.max(max, text.length);
                });
                col.width = max + 3;
            });

            // Xu·∫•t file
            const buffer = await workbook.xlsx.writeBuffer();
            saveAs(new Blob([buffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" }), "Bang_Cham_Cong.xlsx");
            alert("üì§ Xu·∫•t b·∫£ng ch·∫•m c√¥ng th√†nh c√¥ng!");
        });
    </script>
