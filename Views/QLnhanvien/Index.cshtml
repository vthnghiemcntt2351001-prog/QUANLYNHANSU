@{
    ViewData["Title"] = "Quản lý nhân viên";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
.main {
    padding: 15px;
}

/* Giữ các cột đầu cố định khi cuộn ngang */
.table-responsive {
    position: relative;
    overflow-x: auto;
    white-space: nowrap;
}

/* Không cho text xuống hàng */
.table th,
.table td {
    white-space: nowrap;
    vertical-align: middle;
}

/* Cố định cột STT */
.table th:first-child,
.table td:first-child {
    text-align: center;
    vertical-align: middle;
    position: sticky;
    left: 0;
    background-color: #ffffff;
    z-index: 3;
}

/* Cố định cột Mã NV */
.table th:nth-child(2),
.table td:nth-child(2) {
    position: sticky;
    left: 60px;
    background-color: #ffffff;
    z-index: 3;
}

/* Cố định cột Họ Tên */
.table th:nth-child(3),
.table td:nth-child(3) {
    position: sticky;
    left: 160px;
    background-color: #ffffff;
    z-index: 3;
}
.table th, .table td {
    min-width: 120px;
}
.table th:first-child, .table td:first-child { min-width: 60px; }
.table th:nth-child(2), .table td:nth-child(2) { min-width: 100px; }
.table th:nth-child(3), .table td:nth-child(3) { min-width: 200px; }

/* Tiêu đề bảng */
.table thead th {
    text-align: center;
    vertical-align: middle;
    background-color: #cfe2ff !important;
    color: #000;
}
</style>

<main class="main">
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h5 class="m-0 font-weight-bold text-primary">Quản Lý Nhân Viên</h5>
    </div>
    <div class="card-body">

        <!-- Thanh tìm kiếm và lọc -->
        <div class="row mb-3 align-items-center">
            <div class="col-md-4">
                <input id="searchInput" class="form-control" type="search" placeholder="Tìm nhân viên..." />
            </div>
            <div class="col-md-5">
                <select id="filterPhongBan" class="form-select">
                    <option value="all">Tất cả Phòng Ban</option>
                    <option value="Kỹ Thuật">Phòng Kỹ Thuật</option>
                    <option value="Kế Toán">Phòng Kế Toán</option>
                    <option value="Marketing">Phòng Marketing</option>
                </select>
            </div>
            <div class="col-md-3 text-end">
                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">
                    <i class="fas fa-plus"></i> Thêm Nhân Viên Mới
                </button>
            </div>
        </div>

        <!-- Bảng nhân viên -->
        <div class="table-responsive">
            <table class="table table-bordered table-hover" id="nhanVienTable">
                <thead>
                    <tr class="table-primary">
                        <th>STT</th>
                        <th>Mã NV</th>
                        <th>Họ Tên</th>
                        <th>Giới Tính</th>
                        <th>Ngày Sinh</th>
                        <th>Phòng Ban</th>
                        <th>Ngày Vào Làm</th>
                        <th>Số Điện Thoại</th>
                        <th>CCCD</th>
                        <th>Email</th>
                        <th>Địa Chỉ</th>
                        <th class="text-center" style="width:120px;">Thao Tác</th>
                    </tr>
                </thead>
                <tbody id="nvBody">
                    <tr>
                        <td>1</td>
                        <td>NV001</td>
                        <td>Nguyễn Văn A</td>
                        <td>Nam</td>
                        <td>01/01/1990</td>
                        <td>Kỹ Thuật</td>
                        <td>01/02/2020</td>
                        <td>0909123456</td>
                        <td>123456789012</td>
                        <td>anv@company.com</td>
                        <td>123 Đường ABC, Quận 1, TP.HCM</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-warning me-2" onclick="editRow(this)">Sửa</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteRow(this)">Xóa</button>
                        </td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>NV002</td>
                        <td>Trần Thị B</td>
                        <td>Nữ</td>
                        <td>02/03/1995</td>
                        <td>Kế Toán</td>
                        <td>05/06/2021</td>
                        <td>0909888777</td>
                        <td>987654321000</td>
                        <td>tranthib@company.com</td>
                        <td>456 Đường XYZ, Quận 3, TP.HCM</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-warning me-2" onclick="editRow(this)">Sửa</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteRow(this)">Xóa</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>
</main>

<!-- Modal thêm nhân viên -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="addModalLabel">Thêm Nhân Viên Mới</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label>Mã NV</label>
            <input id="maNV" class="form-control" />
          </div>
          <div class="col-md-6">
            <label>Họ Tên</label>
            <input id="hoTen" class="form-control" />
          </div>
          <div class="col-md-6">
            <label>Giới Tính</label>
            <select id="gioiTinh" class="form-select">
              <option>Nam</option>
              <option>Nữ</option>
            </select>
          </div>
          <div class="col-md-6">
            <label>Ngày Sinh</label>
            <input id="ngaySinh" type="date" class="form-control" />
          </div>
          <div class="col-md-6">
            <label>Phòng Ban</label>
            <select id="phongBan" class="form-select">
              <option>Kỹ Thuật</option>
              <option>Kế Toán</option>
              <option>Marketing</option>
            </select>
          </div>
          <div class="col-md-6">
            <label>Ngày Vào Làm</label>
            <input id="ngayVaoLam" type="date" class="form-control" />
          </div>
          <div class="col-md-6">
            <label>Số Điện Thoại</label>
            <input id="sdt" class="form-control" />
          </div>
          <div class="col-md-6">
            <label>CCCD</label>
            <input id="cccd" class="form-control" />
          </div>
          <div class="col-md-6">
            <label>Email</label>
            <input id="email" class="form-control" />
          </div>
          <div class="col-md-6">
            <label>Địa Chỉ</label>
            <input id="diaChi" class="form-control" />
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" class="btn btn-success" onclick="addEmployee()">Lưu</button>
      </div>
    </div>
  </div>
</div>

<script>
// --- Tìm kiếm ---
document.getElementById('searchInput').addEventListener('keyup', function () {
    let filter = this.value.toLowerCase();
    let rows = document.querySelectorAll('#nvBody tr');
    rows.forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(filter) ? '' : 'none';
    });
});

// --- Lọc phòng ban ---
document.getElementById('filterPhongBan').addEventListener('change', function () {
    let filter = this.value;
    let rows = document.querySelectorAll('#nvBody tr');
    rows.forEach(row => {
        let phong = row.cells[5].innerText.trim();
        row.style.display = (filter === 'all' || phong === filter) ? '' : 'none';
    });
});

// --- Xóa nhân viên ---
function deleteRow(btn) {
    if (confirm('Bạn có chắc muốn xóa nhân viên này không?')) {
        btn.closest('tr').remove();
    }
}

// --- Sửa nhân viên ---
function editRow(btn) {
    let row = btn.closest('tr');
    let cells = row.querySelectorAll('td');
    let newName = prompt("Nhập tên mới:", cells[2].innerText);
    if (newName !== null && newName.trim() !== "") {
        cells[2].innerText = newName;
    }
}

// --- Thêm nhân viên ---
function addEmployee() {
    let tbody = document.getElementById('nvBody');
    let rowCount = tbody.rows.length + 1;
    let row = tbody.insertRow();

    row.innerHTML = `
        <td>${rowCount}</td>
        <td>${maNV.value}</td>
        <td>${hoTen.value}</td>
        <td>${gioiTinh.value}</td>
        <td>${ngaySinh.value}</td>
        <td>${phongBan.value}</td>
        <td>${ngayVaoLam.value}</td>
        <td>${sdt.value}</td>
        <td>${cccd.value}</td>
        <td>${email.value}</td>
        <td>${diaChi.value}</td>
        <td class="text-center">
            <button class="btn btn-sm btn-warning me-2" onclick="editRow(this)">Sửa</button>
            <button class="btn btn-sm btn-danger" onclick="deleteRow(this)">Xóa</button>
        </td>`;

    // Đóng modal
    var modal = bootstrap.Modal.getInstance(document.getElementById('addModal'));
    modal.hide();
    document.querySelector('#addModal form')?.reset();
}
</script>
