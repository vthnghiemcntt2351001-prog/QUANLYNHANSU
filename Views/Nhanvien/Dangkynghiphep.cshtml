@{
    ViewData["Title"] = "ÄÄƒng kÃ½ nghá»‰ phÃ©p";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    body {
        background-color: #f4f6f9;
        font-family: "Segoe UI", sans-serif;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 30px 0;
    }

    .page-header h2 {
        color: #007bff;
        font-weight: 600;
    }

    .btn-action {
        background: linear-gradient(135deg, #0d6efd, #00b4d8);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 8px 14px;
        transition: 0.3s;
    }

    .btn-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(13,110,253,0.3);
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    #formDangKyNghi {
        display: none;
        animation: fadeIn 0.4s ease;
    }

   

    .card-form {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }

    .leave-table th {
        background-color: #0d6efd;
        color: white;
        text-align: center;
    }

    .leave-table td {
        text-align: center;
        vertical-align: middle;
    }

    .badge-pending {
        background-color: #ffc107;
        color: black;
    }

    .badge-approved {
        background-color: #198754;
    }

    .badge-rejected {
        background-color: #dc3545;
    }

    /* Toast gÃ³c pháº£i */
    .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 2000;
    }

    .toast {
        border-left: 5px solid #0d6efd;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    }

    .toast-success {
        border-left-color: #198754;
    }

    .toast-warning {
        border-left-color: #ffc107;
    }
</style>


<div class="container mt-4">
    <div class="page-header">
        <h2>ğŸ“ ÄÄƒng kÃ½ nghá»‰ phÃ©p</h2>
        <div>
            <button id="btnShowForm" class="btn btn-action me-2">â• ÄÄƒng kÃ½ nghá»‰ phÃ©p</button>
            <button id="btnCheckStatus" class="btn btn-success"><i class="bi bi-check2-circle"></i> Kiá»ƒm tra phÃª duyá»‡t</button>
        </div>
    </div>

    <!-- Form Ä‘Äƒng kÃ½ nghá»‰ -->
    <div id="formDangKyNghi" class="card-form">
        <h5 class="text-primary mb-3">ğŸ“‹ Äiá»n thÃ´ng tin nghá»‰ phÃ©p</h5>
        <form id="formNghi">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Tá»« ngÃ y</label>
                    <input type="date" class="form-control" id="fromDate" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Äáº¿n ngÃ y</label>
                    <input type="date" class="form-control" id="toDate" required>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <label class="form-label">Loáº¡i nghá»‰</label>
                    <select class="form-select" id="type">
                        <option>Nghá»‰ phÃ©p nÄƒm</option>
                        <option>Nghá»‰ á»‘m</option>
                        <option>Nghá»‰ viá»‡c riÃªng</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">LÃ½ do</label>
                    <input type="text" class="form-control" id="reason" placeholder="Nháº­p lÃ½ do nghá»‰..." required>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Ghi chÃº (náº¿u cÃ³)</label>
                <textarea class="form-control" id="note" rows="2"></textarea>
            </div>
            <button type="submit" class="btn btn-primary w-100 mt-2"><i class="bi bi-send"></i> Gá»­i Ä‘Æ¡n Ä‘Äƒng kÃ½</button>
        </form>
    </div>

    <!-- Báº£ng Ä‘Æ¡n Ä‘Ã£ gá»­i -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="text-primary mb-3">ğŸ“… Lá»‹ch sá»­ Ä‘Æ¡n nghá»‰ phÃ©p</h5>
            <div class="table-responsive">
                <table class="table table-bordered table-striped leave-table" id="leaveTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Tá»« ngÃ y</th>
                            <th>Äáº¿n ngÃ y</th>
                            <th>Loáº¡i nghá»‰</th>
                            <th>LÃ½ do</th>
                            <th>Tráº¡ng thÃ¡i</th>
                        </tr>
                    </thead>
                    <tbody id="leaveList">
                        <tr>
                            <td>1</td>
                            <td>01/11/2025</td>
                            <td>03/11/2025</td>
                            <td>Nghá»‰ phÃ©p nÄƒm</td>
                            <td>Vá» quÃª</td>
                            <td><span class="badge badge-approved">ÄÃ£ duyá»‡t</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Toast -->
<div class="toast-container" id="toastContainer"></div>


<script>
    let donIndex = 2;
    let currentStatus = "pending";

    // ğŸ‘‰ Hiá»‡n / áº¨n form Ä‘Äƒng kÃ½
    document.getElementById("btnShowForm").addEventListener("click", function () {
        const form = document.getElementById("formDangKyNghi");
        form.style.display = form.style.display === "none" ? "block" : "none";
    });

    // ğŸ“¨ Gá»­i Ä‘Æ¡n Ä‘Äƒng kÃ½
    document.getElementById("formNghi").addEventListener("submit", function (e) {
        e.preventDefault();
        const from = document.getElementById("fromDate").value;
        const to = document.getElementById("toDate").value;
        const type = document.getElementById("type").value;
        const reason = document.getElementById("reason").value;

        const newRow = `
            <tr>
                <td>${donIndex++}</td>
                <td>${formatDate(from)}</td>
                <td>${formatDate(to)}</td>
                <td>${type}</td>
                <td>${reason}</td>
                <td><span class="badge badge-pending">Chá» duyá»‡t</span></td>
            </tr>`;
        document.getElementById("leaveList").insertAdjacentHTML("beforeend", newRow);
        showToast("âœ… ÄÆ¡n nghá»‰ phÃ©p Ä‘Ã£ Ä‘Æ°á»£c gá»­i!", "success");

        document.getElementById("formNghi").reset();
        document.getElementById("formDangKyNghi").style.display = "none";
        currentStatus = "pending";
    });

    // ğŸ” Kiá»ƒm tra phÃª duyá»‡t
    document.getElementById("btnCheckStatus").addEventListener("click", function () {
        let message = "";
        if (currentStatus === "pending") message = "ğŸ•’ ÄÆ¡n cá»§a báº¡n Ä‘ang chá» duyá»‡t!";
        else if (currentStatus === "approved") message = "âœ… ÄÆ¡n cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c phÃª duyá»‡t!";
        else message = "âŒ ÄÆ¡n cá»§a báº¡n Ä‘Ã£ bá»‹ tá»« chá»‘i!";
        showToast(message, "success");
    });

    // âœ… Format ngÃ y
    function formatDate(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleDateString("vi-VN");
    }

    // ğŸ”” Toast Ä‘áº¹p gÃ³c pháº£i
    function showToast(message, type) {
        const id = "toast" + Date.now();
        const bg = type === "success" ? "toast-success" : type === "warning" ? "toast-warning" : "";
        const html = `
        <div class="toast bg-white text-dark ${bg}" id="${id}" role="alert">
            <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>`;
        document.getElementById("toastContainer").insertAdjacentHTML("beforeend", html);
        const toastEl = document.getElementById(id);
        const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
        toast.show();
        toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
    }
</script>

